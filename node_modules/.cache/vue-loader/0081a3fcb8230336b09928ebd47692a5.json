{"remainingRequest":"/Users/juann1095/Documents/GitHub/Sistema Integral de Formación Continua 3.0b/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/juann1095/Documents/GitHub/Sistema Integral de Formación Continua 3.0b/src/components/subpaginas/AdminCargaMasivaComponent.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/juann1095/Documents/GitHub/Sistema Integral de Formación Continua 3.0b/src/components/subpaginas/AdminCargaMasivaComponent.vue","mtime":1645809942000},{"path":"/Users/juann1095/Documents/GitHub/Sistema Integral de Formación Continua 3.0b/node_modules/cache-loader/dist/cjs.js","mtime":1728489819214},{"path":"/Users/juann1095/Documents/GitHub/Sistema Integral de Formación Continua 3.0b/node_modules/babel-loader/lib/index.js","mtime":1728489820331},{"path":"/Users/juann1095/Documents/GitHub/Sistema Integral de Formación Continua 3.0b/node_modules/cache-loader/dist/cjs.js","mtime":1728489819214},{"path":"/Users/juann1095/Documents/GitHub/Sistema Integral de Formación Continua 3.0b/node_modules/vue-loader/lib/index.js","mtime":1728489820388}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgRXhjZWwgZnJvbSAiZXhjZWxqcyI7DQppbXBvcnQgYXhpb3MgZnJvbSAiYXhpb3MiOw0KDQpleHBvcnQgZGVmYXVsdCB7DQogIG5hbWU6ICJBZG1pbkNhcmdhTWFzaXZhQ29tcG9uZW50IiwNCiAgZGF0YSgpIHsNCiAgICByZXR1cm4gew0KICAgICAgZmlsZTE6IG51bGwsDQogICAgICBkYXRvc0pTT046IFtdLA0KICAgICAgbW9kZWxvOiB7fSwNCiAgICB9Ow0KICB9LA0KICBtZXRob2RzOiB7DQogICAgcmVnaXN0cmFSZXN1bHRhZG9zKCkgew0KICAgICAgdGhpcy5kYXRvc0pTT04uZm9yRWFjaCgoZWwpID0+IHsNCiAgICAgICAgaWYgKGVsLmlkUmVnaXN0cm8gJiYgZWwucmVzdWx0YWRvKSB7DQogICAgICAgICAgYXhpb3MNCiAgICAgICAgICAgIC5wdXQoDQogICAgICAgICAgICAgIHByb2Nlc3MuZW52LlZVRV9BUFBfVVJMICsgIi9yZWdpc3Ryb3MvcmVzdWx0YWRvLyIgKyBlbC5pZFJlZ2lzdHJvLA0KICAgICAgICAgICAgICBlbCwNCiAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsNCiAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJiZWFyZXIgIiArIHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oInRva2VuIiksDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgKQ0KICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gew0KICAgICAgICAgICAgICBlbC5yZXN1bHRhZG9fY2FyZ2EgPSByZXMuZGF0YTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGVsLnJlc3VsdGFkb19jYXJnYSA9DQogICAgICAgICAgICAiRXJyb3I6IFJldmlzYXIgbGF5b3V0LCByZXF1aWVyZSBjYW1wb3M6IGlkUmVnaXN0cm8geSByZXN1bHRhZG8iOw0KICAgICAgICB9DQogICAgICB9KTsNCiAgICB9LA0KICAgIGVsaW1pbmFyKCkgew0KICAgICAgdGhpcy5kYXRvc0pTT04uZm9yRWFjaCgoZWwpID0+IHsNCiAgICAgICAgaWYgKGVsLmlkRWxpbWluYXIpIHsNCiAgICAgICAgICBheGlvcw0KICAgICAgICAgICAgLmRlbGV0ZShwcm9jZXNzLmVudi5WVUVfQVBQX1VSTCArICIvcmVnaXN0cm9zL2RlbGV0ZS8iICsgZWwuX2lkLCB7DQogICAgICAgICAgICAgIGhlYWRlcnM6IHsNCiAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiYmVhcmVyICIgKyBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCJ0b2tlbiIpLA0KICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsNCiAgICAgICAgICAgICAgZWwucmVzdWx0YWRvX2NhcmdhID0gcmVzLmRhdGE7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBlbC5yZXN1bHRhZG9fY2FyZ2EgPQ0KICAgICAgICAgICAgIkVycm9yOiBSZXZpc2FyIGxheW91dCwgcmVxdWllcmUgY2FtcG86IGlkRWxpbWluYXIiOw0KICAgICAgICB9DQogICAgICB9KTsNCiAgICB9LA0KICAgIHJlZ2lzdHJhcigpIHsNCiAgICAgIHRoaXMuZGF0b3NKU09OLmZvckVhY2goKGVsKSA9PiB7DQogICAgICAgIGF4aW9zDQogICAgICAgICAgLnBvc3QocHJvY2Vzcy5lbnYuVlVFX0FQUF9VUkwgKyAiL3JlZ2lzdHJvcy9hZG1pbi9yZWdpc3RybyIsIGVsLCB7DQogICAgICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJiZWFyZXIgIiArIHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oInRva2VuIiksDQogICAgICAgICAgICB9LA0KICAgICAgICAgIH0pDQogICAgICAgICAgLnRoZW4oKHJlcykgPT4gew0KICAgICAgICAgICAgZWwucmVzdWx0YWRvX2NhcmdhID0gcmVzLmRhdGE7DQogICAgICAgICAgfSk7DQogICAgICB9KTsNCiAgICB9LA0KICAgIGFzeW5jIGNhcmdhUmVnaXN0cm9zRXhjZWwoKSB7DQogICAgICBjb25zb2xlLmxvZyh0aGlzLmZpbGUxKTsNCiAgICAgIGNvbnN0IGxpYnJvID0gbmV3IEV4Y2VsLldvcmtib29rKCk7DQogICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOw0KDQogICAgICB0aGlzLmRhdG9zSlNPTiA9IFtdOw0KICAgICAgdGhpcy5tb2RlbG8gPSB7fTsNCg0KICAgICAgcmVhZGVyLnJlYWRBc0FycmF5QnVmZmVyKHRoaXMuZmlsZTEpOw0KDQogICAgICByZWFkZXIub25sb2FkID0gKCkgPT4gew0KICAgICAgICBjb25zdCBidWZmZXIgPSByZWFkZXIucmVzdWx0Ow0KICAgICAgICBsaWJyby54bHN4LmxvYWQoYnVmZmVyKS50aGVuKCh3b3JrYm9vaykgPT4gew0KICAgICAgICAgIHdvcmtib29rLndvcmtzaGVldHNbMF0uZWFjaFJvdygocm93LCByb3dJbmRleCkgPT4gew0KICAgICAgICAgICAgaWYgKHJvd0luZGV4ID4gMSkgew0KICAgICAgICAgICAgICB3b3JrYm9vay53b3Jrc2hlZXRzWzBdLmdldFJvdygxKS5lYWNoQ2VsbCgoY2VsZGEsIGNlbGxJbmRleCkgPT4gew0KICAgICAgICAgICAgICAgIHRoaXMubW9kZWxvW2NlbGRhLnZhbHVlXSA9IHJvdy52YWx1ZXNbY2VsbEluZGV4XTsNCiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsby5yZXN1bHRhZG9fY2FyZ2EgPSAiTkEiOw0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgdGhpcy5kYXRvc0pTT04ucHVzaChKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMubW9kZWxvKSkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pOw0KICAgICAgICB9KTsNCiAgICAgIH07DQogICAgfSwNCiAgfSwNCn07DQo="},{"version":3,"sources":["AdminCargaMasivaComponent.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwCA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"AdminCargaMasivaComponent.vue","sourceRoot":"src/components/subpaginas","sourcesContent":["<template>\r\n  <div>\r\n    <h2>Movimientos masivos por layout.</h2>\r\n    <b-form-file\r\n      v-model=\"file1\"\r\n      :state=\"Boolean(file1)\"\r\n      placeholder=\"Elije un archivo para regitro o arrastralo aquí...\"\r\n      drop-placeholder=\"Arrastra el arvhivo aquí...\"\r\n      @input=\"cargaRegistrosExcel()\"\r\n    ></b-form-file>\r\n    <div>\r\n      <b-table striped hover :items=\"datosJSON\"></b-table>\r\n    </div>\r\n    <div>\r\n      <b-button\r\n        class=\"m-2\"\r\n        variant=\"success\"\r\n        :disabled=\"datosJSON.length <= 0\"\r\n        @click=\"registrar\"\r\n        >Registrar</b-button\r\n      >\r\n      <b-button\r\n        class=\"m-2\"\r\n        variant=\"primary\"\r\n        :disabled=\"datosJSON.length <= 0\"\r\n        @click=\"registraResultados\"\r\n        >Reg. Resultados</b-button\r\n      >\r\n      <b-button\r\n        class=\"m-2\"\r\n        variant=\"danger\"\r\n        :disabled=\"datosJSON.length <= 0\"\r\n        @click=\"eliminar\"\r\n        >Eliminar</b-button\r\n      >\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Excel from \"exceljs\";\r\nimport axios from \"axios\";\r\n\r\nexport default {\r\n  name: \"AdminCargaMasivaComponent\",\r\n  data() {\r\n    return {\r\n      file1: null,\r\n      datosJSON: [],\r\n      modelo: {},\r\n    };\r\n  },\r\n  methods: {\r\n    registraResultados() {\r\n      this.datosJSON.forEach((el) => {\r\n        if (el.idRegistro && el.resultado) {\r\n          axios\r\n            .put(\r\n              process.env.VUE_APP_URL + \"/registros/resultado/\" + el.idRegistro,\r\n              el,\r\n              {\r\n                headers: {\r\n                  Authorization: \"bearer \" + sessionStorage.getItem(\"token\"),\r\n                },\r\n              }\r\n            )\r\n            .then((res) => {\r\n              el.resultado_carga = res.data;\r\n            });\r\n        } else {\r\n          el.resultado_carga =\r\n            \"Error: Revisar layout, requiere campos: idRegistro y resultado\";\r\n        }\r\n      });\r\n    },\r\n    eliminar() {\r\n      this.datosJSON.forEach((el) => {\r\n        if (el.idEliminar) {\r\n          axios\r\n            .delete(process.env.VUE_APP_URL + \"/registros/delete/\" + el._id, {\r\n              headers: {\r\n                Authorization: \"bearer \" + sessionStorage.getItem(\"token\"),\r\n              },\r\n            })\r\n            .then((res) => {\r\n              el.resultado_carga = res.data;\r\n            });\r\n        } else {\r\n          el.resultado_carga =\r\n            \"Error: Revisar layout, requiere campo: idEliminar\";\r\n        }\r\n      });\r\n    },\r\n    registrar() {\r\n      this.datosJSON.forEach((el) => {\r\n        axios\r\n          .post(process.env.VUE_APP_URL + \"/registros/admin/registro\", el, {\r\n            headers: {\r\n              Authorization: \"bearer \" + sessionStorage.getItem(\"token\"),\r\n            },\r\n          })\r\n          .then((res) => {\r\n            el.resultado_carga = res.data;\r\n          });\r\n      });\r\n    },\r\n    async cargaRegistrosExcel() {\r\n      console.log(this.file1);\r\n      const libro = new Excel.Workbook();\r\n      const reader = new FileReader();\r\n\r\n      this.datosJSON = [];\r\n      this.modelo = {};\r\n\r\n      reader.readAsArrayBuffer(this.file1);\r\n\r\n      reader.onload = () => {\r\n        const buffer = reader.result;\r\n        libro.xlsx.load(buffer).then((workbook) => {\r\n          workbook.worksheets[0].eachRow((row, rowIndex) => {\r\n            if (rowIndex > 1) {\r\n              workbook.worksheets[0].getRow(1).eachCell((celda, cellIndex) => {\r\n                this.modelo[celda.value] = row.values[cellIndex];\r\n                this.modelo.resultado_carga = \"NA\";\r\n              });\r\n              this.datosJSON.push(JSON.parse(JSON.stringify(this.modelo)));\r\n            }\r\n          });\r\n        });\r\n      };\r\n    },\r\n  },\r\n};\r\n</script>"]}]}