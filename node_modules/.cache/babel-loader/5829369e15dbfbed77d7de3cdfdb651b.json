{"remainingRequest":"/Users/juann1095/Documents/GitHub/SIFC_BB/Sistema-Integral-Formacion-Continua-3.0B-/node_modules/babel-loader/lib/index.js!/Users/juann1095/Documents/GitHub/SIFC_BB/Sistema-Integral-Formacion-Continua-3.0B-/node_modules/cache-loader/dist/cjs.js??ref--1-0!/Users/juann1095/Documents/GitHub/SIFC_BB/Sistema-Integral-Formacion-Continua-3.0B-/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/juann1095/Documents/GitHub/SIFC_BB/Sistema-Integral-Formacion-Continua-3.0B-/src/components/subpaginas/AdminCargaMasivaComponent.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/juann1095/Documents/GitHub/SIFC_BB/Sistema-Integral-Formacion-Continua-3.0B-/src/components/subpaginas/AdminCargaMasivaComponent.vue","mtime":1645809942000},{"path":"/Users/juann1095/Documents/GitHub/SIFC_BB/Sistema-Integral-Formacion-Continua-3.0B-/babel.config.js","mtime":1645809942000},{"path":"/Users/juann1095/Documents/GitHub/SIFC_BB/Sistema-Integral-Formacion-Continua-3.0B-/node_modules/cache-loader/dist/cjs.js","mtime":1728489819214},{"path":"/Users/juann1095/Documents/GitHub/SIFC_BB/Sistema-Integral-Formacion-Continua-3.0B-/node_modules/babel-loader/lib/index.js","mtime":1728489820331},{"path":"/Users/juann1095/Documents/GitHub/SIFC_BB/Sistema-Integral-Formacion-Continua-3.0B-/node_modules/cache-loader/dist/cjs.js","mtime":1728489819214},{"path":"/Users/juann1095/Documents/GitHub/SIFC_BB/Sistema-Integral-Formacion-Continua-3.0B-/node_modules/vue-loader/lib/index.js","mtime":1728489820388}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KaW1wb3J0IEV4Y2VsIGZyb20gImV4Y2VsanMiOwppbXBvcnQgYXhpb3MgZnJvbSAiYXhpb3MiOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIkFkbWluQ2FyZ2FNYXNpdmFDb21wb25lbnQiLAoKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgZmlsZTE6IG51bGwsCiAgICAgIGRhdG9zSlNPTjogW10sCiAgICAgIG1vZGVsbzoge30KICAgIH07CiAgfSwKCiAgbWV0aG9kczogewogICAgcmVnaXN0cmFSZXN1bHRhZG9zKCkgewogICAgICB0aGlzLmRhdG9zSlNPTi5mb3JFYWNoKGVsID0+IHsKICAgICAgICBpZiAoZWwuaWRSZWdpc3RybyAmJiBlbC5yZXN1bHRhZG8pIHsKICAgICAgICAgIGF4aW9zLnB1dChwcm9jZXNzLmVudi5WVUVfQVBQX1VSTCArICIvcmVnaXN0cm9zL3Jlc3VsdGFkby8iICsgZWwuaWRSZWdpc3RybywgZWwsIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJiZWFyZXIgIiArIHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oInRva2VuIikKICAgICAgICAgICAgfQogICAgICAgICAgfSkudGhlbihyZXMgPT4gewogICAgICAgICAgICBlbC5yZXN1bHRhZG9fY2FyZ2EgPSByZXMuZGF0YTsKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBlbC5yZXN1bHRhZG9fY2FyZ2EgPSAiRXJyb3I6IFJldmlzYXIgbGF5b3V0LCByZXF1aWVyZSBjYW1wb3M6IGlkUmVnaXN0cm8geSByZXN1bHRhZG8iOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAoKICAgIGVsaW1pbmFyKCkgewogICAgICB0aGlzLmRhdG9zSlNPTi5mb3JFYWNoKGVsID0+IHsKICAgICAgICBpZiAoZWwuaWRFbGltaW5hcikgewogICAgICAgICAgYXhpb3MuZGVsZXRlKHByb2Nlc3MuZW52LlZVRV9BUFBfVVJMICsgIi9yZWdpc3Ryb3MvZGVsZXRlLyIgKyBlbC5faWQsIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJiZWFyZXIgIiArIHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oInRva2VuIikKICAgICAgICAgICAgfQogICAgICAgICAgfSkudGhlbihyZXMgPT4gewogICAgICAgICAgICBlbC5yZXN1bHRhZG9fY2FyZ2EgPSByZXMuZGF0YTsKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBlbC5yZXN1bHRhZG9fY2FyZ2EgPSAiRXJyb3I6IFJldmlzYXIgbGF5b3V0LCByZXF1aWVyZSBjYW1wbzogaWRFbGltaW5hciI7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCgogICAgcmVnaXN0cmFyKCkgewogICAgICB0aGlzLmRhdG9zSlNPTi5mb3JFYWNoKGVsID0+IHsKICAgICAgICBheGlvcy5wb3N0KHByb2Nlc3MuZW52LlZVRV9BUFBfVVJMICsgIi9yZWdpc3Ryb3MvYWRtaW4vcmVnaXN0cm8iLCBlbCwgewogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICBBdXRob3JpemF0aW9uOiAiYmVhcmVyICIgKyBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCJ0b2tlbiIpCiAgICAgICAgICB9CiAgICAgICAgfSkudGhlbihyZXMgPT4gewogICAgICAgICAgZWwucmVzdWx0YWRvX2NhcmdhID0gcmVzLmRhdGE7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSwKCiAgICBhc3luYyBjYXJnYVJlZ2lzdHJvc0V4Y2VsKCkgewogICAgICBjb25zb2xlLmxvZyh0aGlzLmZpbGUxKTsKICAgICAgY29uc3QgbGlicm8gPSBuZXcgRXhjZWwuV29ya2Jvb2soKTsKICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKICAgICAgdGhpcy5kYXRvc0pTT04gPSBbXTsKICAgICAgdGhpcy5tb2RlbG8gPSB7fTsKICAgICAgcmVhZGVyLnJlYWRBc0FycmF5QnVmZmVyKHRoaXMuZmlsZTEpOwoKICAgICAgcmVhZGVyLm9ubG9hZCA9ICgpID0+IHsKICAgICAgICBjb25zdCBidWZmZXIgPSByZWFkZXIucmVzdWx0OwogICAgICAgIGxpYnJvLnhsc3gubG9hZChidWZmZXIpLnRoZW4od29ya2Jvb2sgPT4gewogICAgICAgICAgd29ya2Jvb2sud29ya3NoZWV0c1swXS5lYWNoUm93KChyb3csIHJvd0luZGV4KSA9PiB7CiAgICAgICAgICAgIGlmIChyb3dJbmRleCA+IDEpIHsKICAgICAgICAgICAgICB3b3JrYm9vay53b3Jrc2hlZXRzWzBdLmdldFJvdygxKS5lYWNoQ2VsbCgoY2VsZGEsIGNlbGxJbmRleCkgPT4gewogICAgICAgICAgICAgICAgdGhpcy5tb2RlbG9bY2VsZGEudmFsdWVdID0gcm93LnZhbHVlc1tjZWxsSW5kZXhdOwogICAgICAgICAgICAgICAgdGhpcy5tb2RlbG8ucmVzdWx0YWRvX2NhcmdhID0gIk5BIjsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB0aGlzLmRhdG9zSlNPTi5wdXNoKEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5tb2RlbG8pKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9OwogICAgfQoKICB9Cn07"},{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwCA;AACA;AAEA;EACAA,iCADA;;EAEAC;IACA;MACAC,WADA;MAEAC,aAFA;MAGAC;IAHA;EAKA,CARA;;EASAC;IACAC;MACA;QACA;UACAC,MACAC,GADA,CAEAC,iEAFA,EAGAC,EAHA,EAIA;YACAC;cACAC;YADA;UADA,CAJA,EAUAC,IAVA,CAUAC;YACAJ;UACA,CAZA;QAaA,CAdA,MAcA;UACAA,qBACA,gEADA;QAEA;MACA,CAnBA;IAoBA,CAtBA;;IAuBAK;MACA;QACA;UACAR,MACAS,MADA,CACAP,uDADA,EACA;YACAE;cACAC;YADA;UADA,CADA,EAMAC,IANA,CAMAC;YACAJ;UACA,CARA;QASA,CAVA,MAUA;UACAA,qBACA,mDADA;QAEA;MACA,CAfA;IAgBA,CAxCA;;IAyCAO;MACA;QACAV,MACAW,IADA,CACAT,qDADA,EACAC,EADA,EACA;UACAC;YACAC;UADA;QADA,CADA,EAMAC,IANA,CAMAC;UACAJ;QACA,CARA;MASA,CAVA;IAWA,CArDA;;IAsDA;MACAS;MACA;MACA;MAEA;MACA;MAEAC;;MAEAA;QACA;QACAC;UACAC;YACA;cACAA;gBACA;gBACA;cACA,CAHA;cAIA;YACA;UACA,CARA;QASA,CAVA;MAWA,CAbA;IAcA;;EA9EA;AATA","names":["name","data","file1","datosJSON","modelo","methods","registraResultados","axios","put","process","el","headers","Authorization","then","res","eliminar","delete","registrar","post","console","reader","libro","workbook"],"sourceRoot":"src/components/subpaginas","sources":["AdminCargaMasivaComponent.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <h2>Movimientos masivos por layout.</h2>\r\n    <b-form-file\r\n      v-model=\"file1\"\r\n      :state=\"Boolean(file1)\"\r\n      placeholder=\"Elije un archivo para regitro o arrastralo aquí...\"\r\n      drop-placeholder=\"Arrastra el arvhivo aquí...\"\r\n      @input=\"cargaRegistrosExcel()\"\r\n    ></b-form-file>\r\n    <div>\r\n      <b-table striped hover :items=\"datosJSON\"></b-table>\r\n    </div>\r\n    <div>\r\n      <b-button\r\n        class=\"m-2\"\r\n        variant=\"success\"\r\n        :disabled=\"datosJSON.length <= 0\"\r\n        @click=\"registrar\"\r\n        >Registrar</b-button\r\n      >\r\n      <b-button\r\n        class=\"m-2\"\r\n        variant=\"primary\"\r\n        :disabled=\"datosJSON.length <= 0\"\r\n        @click=\"registraResultados\"\r\n        >Reg. Resultados</b-button\r\n      >\r\n      <b-button\r\n        class=\"m-2\"\r\n        variant=\"danger\"\r\n        :disabled=\"datosJSON.length <= 0\"\r\n        @click=\"eliminar\"\r\n        >Eliminar</b-button\r\n      >\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Excel from \"exceljs\";\r\nimport axios from \"axios\";\r\n\r\nexport default {\r\n  name: \"AdminCargaMasivaComponent\",\r\n  data() {\r\n    return {\r\n      file1: null,\r\n      datosJSON: [],\r\n      modelo: {},\r\n    };\r\n  },\r\n  methods: {\r\n    registraResultados() {\r\n      this.datosJSON.forEach((el) => {\r\n        if (el.idRegistro && el.resultado) {\r\n          axios\r\n            .put(\r\n              process.env.VUE_APP_URL + \"/registros/resultado/\" + el.idRegistro,\r\n              el,\r\n              {\r\n                headers: {\r\n                  Authorization: \"bearer \" + sessionStorage.getItem(\"token\"),\r\n                },\r\n              }\r\n            )\r\n            .then((res) => {\r\n              el.resultado_carga = res.data;\r\n            });\r\n        } else {\r\n          el.resultado_carga =\r\n            \"Error: Revisar layout, requiere campos: idRegistro y resultado\";\r\n        }\r\n      });\r\n    },\r\n    eliminar() {\r\n      this.datosJSON.forEach((el) => {\r\n        if (el.idEliminar) {\r\n          axios\r\n            .delete(process.env.VUE_APP_URL + \"/registros/delete/\" + el._id, {\r\n              headers: {\r\n                Authorization: \"bearer \" + sessionStorage.getItem(\"token\"),\r\n              },\r\n            })\r\n            .then((res) => {\r\n              el.resultado_carga = res.data;\r\n            });\r\n        } else {\r\n          el.resultado_carga =\r\n            \"Error: Revisar layout, requiere campo: idEliminar\";\r\n        }\r\n      });\r\n    },\r\n    registrar() {\r\n      this.datosJSON.forEach((el) => {\r\n        axios\r\n          .post(process.env.VUE_APP_URL + \"/registros/admin/registro\", el, {\r\n            headers: {\r\n              Authorization: \"bearer \" + sessionStorage.getItem(\"token\"),\r\n            },\r\n          })\r\n          .then((res) => {\r\n            el.resultado_carga = res.data;\r\n          });\r\n      });\r\n    },\r\n    async cargaRegistrosExcel() {\r\n      console.log(this.file1);\r\n      const libro = new Excel.Workbook();\r\n      const reader = new FileReader();\r\n\r\n      this.datosJSON = [];\r\n      this.modelo = {};\r\n\r\n      reader.readAsArrayBuffer(this.file1);\r\n\r\n      reader.onload = () => {\r\n        const buffer = reader.result;\r\n        libro.xlsx.load(buffer).then((workbook) => {\r\n          workbook.worksheets[0].eachRow((row, rowIndex) => {\r\n            if (rowIndex > 1) {\r\n              workbook.worksheets[0].getRow(1).eachCell((celda, cellIndex) => {\r\n                this.modelo[celda.value] = row.values[cellIndex];\r\n                this.modelo.resultado_carga = \"NA\";\r\n              });\r\n              this.datosJSON.push(JSON.parse(JSON.stringify(this.modelo)));\r\n            }\r\n          });\r\n        });\r\n      };\r\n    },\r\n  },\r\n};\r\n</script>"]}]}